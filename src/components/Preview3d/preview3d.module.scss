.wrapper {
  @include size(100%);
  position: relative;
}

.preview {
  @include absolute(50% x x 50%);
  width: calc(var(--width, 0) * 1px);
  height: calc(var(--height, 0) * 1px);
  // In order:
  // 1)   centers the frame on X/Y
  // 2)   scales to fit on rotation
  // 3,4) rotates frame on 30deg axis (isometric)
  // 5)   centers the frame on Z axis with changing depth
  transform: translate(-50%, -50%) scale(var(--scale, 1)) rotateX(calc(var(--angle, 0) * -1deg))
    rotateY(calc(var(--angle, 0) * 1deg)) translate3d(0, 0, calc(0.5px * var(--depth, 0)));
  transition: transform 300ms ease;
  will-change: transform;

  &,
  > * {
    transform-style: preserve-3d;
  }
}

.preview__front {
  @include absolute(0);

  img {
    @include absolute(0);
    @include size(100%);
    object-fit: cover;
  }

  &.preview__front--artwork {
    @include absolute(3px);
    overflow: hidden;
    transform: translateZ(sz(-4));

    &.matting--dark {
      background-color: $c-mat-dark;
    }

    &.matting--light {
      background-color: $c-mat-light;
    }

    img {
      @include absolute(50% x x 50%);
      width: calc(var(--width, 0) * 1px);
      height: calc(var(--height, 0) * 1px);
      transform: translate(-50%, -50%);
    }

    $matting-depth: 3px;
    &:not(.matting--none)::before {
      @include absolute(50% x x 50%);
      box-shadow: inset 0 0 4px 1px c('shadow', 0.5);
      content: '';
      width: calc(var(--width, 0) * 1px + #{$matting-depth * 2});
      height: calc(var(--height, 0) * 1px + #{$matting-depth * 2});
      transform: translate(-50%, -50%);
    }

    &.scaled {
      img {
        top: calc(var(--y, 0) * 1px);
        left: calc(var(--x, 0) * 1px);
        object-fit: fill;
        transform: scale(calc(var(--scale, 100) / 100));
      }

      &:not(.matting--none)::before {
        --mat-width: (var(--width, 0) * 1px) * (var(--scale, 100) / 100);
        --mat-x-delta: ((var(--width, 0) * 1px - var(--mat-width)) / 2);

        --mat-height: (var(--height, 0) * 1px) * (var(--scale, 100) / 100);
        --mat-y-delta: ((var(--height, 0) * 1px - var(--mat-height)) / 2);

        top: calc((var(--y, 0) * 1px) + var(--mat-y-delta) - #{$matting-depth});
        left: calc((var(--x, 0) * 1px) + var(--mat-x-delta) - #{$matting-depth});
        width: calc(var(--mat-width) + #{$matting-depth * 2});
        height: calc(var(--mat-height) + #{$matting-depth * 2});
        transform: none;
      }
    }
  }

  &:not(.preview__front--artwork) {
    img {
      object-fit: fill;
    }
  }
}

.preview__glass {
  @include absolute(sz(2));
  background: radial-gradient(circle at top left, c('white', 0.2), c('white', 0));
  opacity: 0;
  transform: translateZ(sz(-4));
  transition: 150ms ease-out;

  &--shine {
    opacity: 1;
  }
}

.preview__top {
  @include absolute(50% x x 50%);
  background-color: var(--color, c('bg'));
  height: calc(var(--depth, 0) * 1px);
  transform: translate(-50%, -50%) rotateX(-90deg) rotateY(180deg)
    translate3d(0, calc(var(--depth, 0) * 0.5px), calc(var(--height, 0) * 0.5px));
  transform-origin: center center;
  width: 100%;
  will-change: transform;
}

.preview__left {
  @include absolute(50% x x 50%);
  background-color: var(--color-shade, c('bg'));
  height: 100%;
  transform: translate(-50%, -50%) rotateX(0) rotateY(90deg)
    translate3d(calc(var(--depth, 0) * 0.5px), 0, calc(var(--width, 0) * -0.5px));
  transform-origin: center center;
  width: calc(var(--depth, 0) * 1px);
  will-change: transform;
}

.preview__window-bottom {
  background-color: var(--color, c('bg'));
  position: absolute;
  top: calc(var(--y, 0) * 1px);
  left: calc(var(--x, 0) * 1px);
  height: calc(var(--length, 0) * 1px);
  width: calc(var(--depth, 0) * 1px);
  transform-origin: top left;
  transform: rotateZ(calc(var(--angle, 0) * 1deg)) rotateY(90deg);
}

.preview__window-right {
  background-color: var(--color-shade, c('bg'));
  position: absolute;
  top: calc(var(--y, 0) * 1px);
  left: calc(var(--x, 0) * 1px);
  height: calc(var(--length, 0) * 1px);
  width: calc(var(--depth, 0) * 1px);
  transform-origin: top left;
  transform: rotateZ(calc(var(--angle, 0) * 1deg)) rotateY(90deg);
}
